<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repair vs. Replace | Carbon Impact Calculator</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        eco: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        },
                        sky: {
                            800: '#075985',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #f0fdf4;
            background-image: radial-gradient(#dcfce7 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.05);
        }
        .slide-in {
            animation: slideIn 0.5s ease-out forwards;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .stat-card {
            transition: transform 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #16a34a;
            margin-top: -8px;
            cursor: pointer;
            box-shadow: 0 0 0 4px #bbf7d0;
            transition: background 0.2s, transform 0.2s;
        }
        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: #dcfce7;
            border-radius: 3px;
        }
        /* Custom Checkbox */
        .custom-checkbox:checked {
            background-color: #16a34a;
            border-color: #16a34a;
        }
        .custom-checkbox:checked + div {
            font-weight: 600;
            color: #166534;
        }
    </style>
</head>
<body class="text-slate-800 antialiased min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="w-full bg-white/80 backdrop-blur-md border-b border-eco-100 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-eco-500 text-white p-2 rounded-lg">
                    <i class="fa-solid fa-screwdriver-wrench"></i>
                </div>
                <h1 class="text-xl font-bold tracking-tight text-eco-900">EcoRepair<span class="text-eco-500">Calc</span></h1>
            </div>
            <div class="hidden md:flex gap-6 text-sm font-semibold text-slate-600">
                <a href="#sources" class="hover:text-eco-600 transition">Data Sources</a>
                <a href="#about" class="hover:text-eco-600 transition">About E-Waste</a>
                <button onclick="document.getElementById('calcForm').scrollIntoView({behavior: 'smooth'})" class="bg-eco-100 text-eco-800 px-4 py-1.5 rounded-full hover:bg-eco-200 transition">Start Calculating</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow max-w-6xl mx-auto px-4 py-8 w-full grid md:grid-cols-12 gap-8">
        
        <!-- Left Column: Input Form -->
        <div class="md:col-span-5 lg:col-span-4 space-y-6">
            <div class="glass-panel rounded-2xl p-6 md:p-8">
                <h2 class="text-2xl font-bold text-slate-800 mb-1">Device Details</h2>
                <p class="text-slate-500 text-sm mb-6">Enter your device information to see the impact.</p>

                <form id="calcForm" class="space-y-5" onsubmit="calculateImpact(event)">
                    
                    <!-- Device Type -->
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Device Type</label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="device" value="smartphone" class="peer sr-only" checked onchange="handleDeviceChange()">
                                <div class="p-3 rounded-xl border-2 border-slate-100 peer-checked:border-eco-500 peer-checked:bg-eco-50 hover:bg-slate-50 transition text-center">
                                    <i class="fa-solid fa-mobile-screen text-2xl mb-1 text-slate-400 peer-checked:text-eco-600"></i>
                                    <div class="text-xs font-semibold">Phone</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="device" value="laptop" class="peer sr-only" onchange="handleDeviceChange()">
                                <div class="p-3 rounded-xl border-2 border-slate-100 peer-checked:border-eco-500 peer-checked:bg-eco-50 hover:bg-slate-50 transition text-center">
                                    <i class="fa-solid fa-laptop text-2xl mb-1 text-slate-400 peer-checked:text-eco-600"></i>
                                    <div class="text-xs font-semibold">Laptop</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="device" value="tablet" class="peer sr-only" onchange="handleDeviceChange()">
                                <div class="p-3 rounded-xl border-2 border-slate-100 peer-checked:border-eco-500 peer-checked:bg-eco-50 hover:bg-slate-50 transition text-center">
                                    <i class="fa-solid fa-tablet-screen-button text-2xl mb-1 text-slate-400 peer-checked:text-eco-600"></i>
                                    <div class="text-xs font-semibold">Tablet</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="device" value="desktop" class="peer sr-only" onchange="handleDeviceChange()">
                                <div class="p-3 rounded-xl border-2 border-slate-100 peer-checked:border-eco-500 peer-checked:bg-eco-50 hover:bg-slate-50 transition text-center">
                                    <i class="fa-solid fa-computer text-2xl mb-1 text-slate-400 peer-checked:text-eco-600"></i>
                                    <div class="text-xs font-semibold">Desktop</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- STANDARD MODEL INPUT (Phone/Tablet/Laptop) -->
                    <div id="standardModelInput">
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Model Identification</label>
                        <div class="grid grid-cols-12 gap-3">
                            <div class="col-span-8">
                                <input type="text" id="modelName" placeholder="e.g. iPhone 14 Pro, Dell XPS 15" 
                                    class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-eco-500 placeholder-slate-400"
                                    oninput="showTypingHint()">
                                <div id="modelHint" class="text-[10px] text-eco-600 mt-1 hidden font-medium">
                                    <i class="fa-solid fa-check"></i> Adjusting estimates for specific model...
                                </div>
                            </div>
                            <div class="col-span-4">
                                <select id="manYear" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-eco-500 h-full">
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- DESKTOP COMPONENT INPUT (Desktop Only) -->
                    <div id="desktopComponentInput" class="hidden">
                        <label class="block text-sm font-semibold text-slate-700 mb-2">Desktop Components</label>
                        <div class="grid grid-cols-2 gap-3 mb-3">
                            <div>
                                <label class="text-[10px] font-bold text-slate-400 uppercase">CPU / Processor</label>
                                <select id="compCPU" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-2 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-eco-500">
                                    <option value="45">Entry Level (i3/Ryzen 3)</option>
                                    <option value="95" selected>Mid Range (i5/Ryzen 5)</option>
                                    <option value="140">High End (i7/i9/Ryzen 7/9)</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-400 uppercase">GPU / Graphics</label>
                                <select id="compGPU" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-2 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-eco-500">
                                    <option value="0">Integrated / None</option>
                                    <option value="120" selected>Entry (xx60 class)</option>
                                    <option value="250">Mid (xx70 class)</option>
                                    <option value="450">High (xx80/90 class)</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-400 uppercase">Motherboard</label>
                                <select id="compMobo" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-2 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-eco-500">
                                    <option value="50">Basic (mATX)</option>
                                    <option value="80" selected>Standard (ATX)</option>
                                    <option value="120">High-End / Gaming</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-400 uppercase">RAM</label>
                                <select id="compRAM" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-2 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-eco-500">
                                    <option value="23">16GB (Std)</option>
                                    <option value="46">32GB</option>
                                    <option value="90">64GB+</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-400 uppercase">Power Supply</label>
                                <select id="compPSU" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-2 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-eco-500">
                                    <option value="35">Standard Efficiency</option>
                                    <option value="75" selected>High Efficiency / Gold+</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-400 uppercase">Case Material</label>
                                <select id="compCase" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-2 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-eco-500">
                                    <option value="25">Standard Steel/Plastic</option>
                                    <option value="60">Aluminum / Tempered Glass</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-12 gap-3">
                            <div class="col-span-12">
                                <label class="text-[10px] font-bold text-slate-400 uppercase">Manufacture Year</label>
                                <select id="manYearDesktop" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-eco-500">
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Repair Details -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">When are you repairing it/got it repaired?</label>
                            <select id="repYear" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-eco-500">
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <!-- Repair Type Checklist -->
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">What needs fixing/is fixed? <span class="text-xs font-normal text-slate-400">(Select all that apply)</span></label>
                            <div id="repairList" class="w-full bg-slate-50 border border-slate-200 rounded-lg p-2 max-h-48 overflow-y-auto grid grid-cols-1 gap-1">
                                <!-- Populated by JS as checkboxes -->
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-eco-600 hover:bg-eco-700 text-white font-bold py-3 rounded-xl shadow-lg shadow-eco-200 transition transform active:scale-95 flex items-center justify-center gap-2">
                        <i class="fa-solid fa-calculator"></i> Calculate Impact
                    </button>
                </form>
            </div>
            
            <!-- Sources Note -->
            <div class="bg-white/50 p-4 rounded-xl text-xs text-slate-500 border border-slate-100">
                <p class="font-semibold text-slate-700 mb-1">ðŸ“Š Data Sources (2024-2026)</p>
                <p class="mb-2">Calculations based on peer-reviewed LCA studies:</p>
                <ul class="space-y-1 ml-3">
                    <li>â€¢ <strong>Fairphone 5 LCA (2024)</strong> - Component breakdowns</li>
                    <li>â€¢ <strong>Dell Latitude LCA</strong> - Laptop manufacturing data</li>
                    <li>â€¢ <strong>Fraunhofer UMSICHT</strong> - E-waste research</li>
                    <li>â€¢ <strong>Refurbed/Fraunhofer Austria (2023)</strong> - Refurbishment impact</li>
                    <li>â€¢ <strong>Water Footprint Network</strong> - Water consumption</li>
                </ul>
                <p class="mt-2 text-[10px] opacity-75">Repair estimates are proportional calculations from full-device LCAs. Desktop values sum verified component data.</p>
            </div>
        </div>

        <!-- Right Column: Results Dashboard -->
        <div class="md:col-span-7 lg:col-span-8">
            
            <!-- Welcome State (Hidden after calculation) -->
            <div id="welcomeState" class="h-full flex flex-col items-center justify-center text-center p-10 opacity-70">
                <div class="bg-white p-6 rounded-full shadow-sm mb-4">
                    <i class="fa-solid fa-earth-americas text-6xl text-eco-200"></i>
                </div>
                <h2 class="text-3xl font-bold text-slate-800 mb-2">Did you know?</h2>
                <p class="text-lg text-slate-600 max-w-md mb-4">Repairing just one laptop saves over <strong>190,000 litres</strong> of waterâ€”enough for a person to drink for 170 years.</p>
                <p class="text-sm text-slate-500 max-w-lg">Manufacturing accounts for <strong>80-85%</strong> of a device's total lifetime carbon emissions. By repairing instead of replacing, you avoid the most polluting phase entirely.</p>
            </div>

            <!-- Results State (Hidden initially) -->
            <div id="resultsState" class="hidden space-y-6 slide-in">
                
                <!-- Main KPI Card -->
                <div class="glass-panel rounded-3xl p-6 md:p-8 bg-gradient-to-br from-eco-500 to-eco-700 text-white relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-8 opacity-10">
                        <i class="fa-solid fa-leaf text-9xl"></i>
                    </div>
                    <div class="relative z-10 grid md:grid-cols-2 gap-6 items-center">
                        <div>
                            <h3 class="text-eco-100 font-semibold mb-1 uppercase tracking-wider text-sm">Carbon Savings</h3>
                            <div class="text-5xl md:text-6xl font-extrabold mb-2"><span id="savedKg">0</span> <span class="text-2xl font-semibold">kg CO2e</span></div>
                            <p class="text-eco-100">You can reduce/reduced your carbon footprint by <span id="reductionPercent" class="bg-white/20 px-2 py-0.5 rounded font-bold text-white">0%</span> compared to buying new.</p>
                        </div>
                        <div class="bg-white/10 rounded-xl p-4 backdrop-blur-sm border border-white/20">
                            <div class="text-sm font-semibold mb-2 flex items-center gap-2">
                                <i class="fa-solid fa-car-side"></i> Equivalent To
                            </div>
                            <div class="text-2xl font-bold mb-1">Driving a Car</div>
                            <div class="text-lg opacity-90">for <span id="carKm" class="font-bold text-yellow-300">0</span> km</div>
                            <div class="text-xs mt-2 opacity-75">(approx <span id="carMiles">0</span> miles)</div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Grid -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <!-- Tree Card -->
                    <div class="stat-card glass-panel p-5 rounded-2xl border-b-4 border-emerald-500">
                        <div class="flex justify-between items-start mb-3">
                            <div class="bg-emerald-100 text-emerald-600 w-10 h-10 rounded-full flex items-center justify-center">
                                <i class="fa-solid fa-tree"></i>
                            </div>
                        </div>
                        <div class="text-3xl font-bold text-slate-800 mb-1" id="treesSaved">0</div>
                        <div class="text-sm text-slate-500 leading-tight">Tree seedlings growing for 10 years</div>
                    </div>

                    <!-- Water Saved -->
                    <div class="stat-card glass-panel p-5 rounded-2xl border-b-4 border-blue-500">
                        <div class="flex justify-between items-start mb-3">
                            <div class="bg-blue-100 text-blue-600 w-10 h-10 rounded-full flex items-center justify-center">
                                <i class="fa-solid fa-droplet"></i>
                            </div>
                        </div>
                        <div class="text-3xl font-bold text-slate-800 mb-1" id="waterSaved">0</div>
                        <div class="text-sm text-slate-500 leading-tight">Litres of water conserved</div>
                    </div>

                    <!-- Trash Saved -->
                    <div class="stat-card glass-panel p-5 rounded-2xl border-b-4 border-orange-500">
                        <div class="flex justify-between items-start mb-3">
                            <div class="bg-orange-100 text-orange-600 w-10 h-10 rounded-full flex items-center justify-center">
                                <i class="fa-solid fa-trash-arrow-up"></i>
                            </div>
                        </div>
                        <div class="text-3xl font-bold text-slate-800 mb-1" id="wasteSaved">0</div>
                        <div class="text-sm text-slate-500 leading-tight">Grams of E-Waste prevented</div>
                    </div>
                </div>

                <!-- Analysis Details -->
                <div class="glass-panel rounded-2xl p-6">
                    <h3 class="text-lg font-bold text-slate-800 mb-4">Embodied Carbon Analysis</h3>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <canvas id="impactChart"></canvas>
                        </div>
                        <div class="flex flex-col justify-center space-y-4 text-sm">
                            <div class="p-3 bg-red-50 rounded-lg border border-red-100">
                                <div class="font-semibold text-red-800">Buying New</div>
                                <div class="text-red-600"><span id="newEmission">0</span> kg CO2e</div>
                                <div class="text-xs text-slate-500 mt-1">Includes extraction, manufacturing (80-85%), transport, and disposal.</div>
                            </div>
                            <div class="flex justify-center">
                                <i class="fa-solid fa-arrow-down text-slate-300"></i>
                            </div>
                            <div class="p-3 bg-eco-50 rounded-lg border border-eco-100">
                                <div class="font-semibold text-eco-800">Repairing Yours</div>
                                <div class="text-eco-600"><span id="repairEmission">0</span> kg CO2e</div>
                                <div class="text-xs text-slate-500 mt-1">Includes all selected spare parts production and shipping. Repair extends device life.</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recommendation -->
                <div class="bg-slate-800 text-slate-200 rounded-2xl p-6 flex gap-4 items-start">
                    <i class="fa-solid fa-lightbulb text-yellow-400 text-xl mt-1"></i>
                    <div>
                        <h4 class="font-bold text-white mb-1">Our Recommendation</h4>
                        <p class="text-sm opacity-80" id="recommendationText">Repairing is highly recommended. By keeping your device for just 1 more year, you reduce your annual environmental impact by up to 31%.</p>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <footer class="mt-auto py-8 text-center text-slate-400 text-sm" id="sources">
        <div class="max-w-4xl mx-auto px-4">
            <h3 class="text-slate-600 font-bold mb-3" id="about">About This Calculator</h3>
            <p class="text-xs mb-4 text-slate-500">
                This calculator uses peer-reviewed Life Cycle Assessment (LCA) data to estimate the environmental impact of repairing versus replacing electronic devices. All carbon footprint values are based on manufacturing emissions, which account for 80-85% of a device's lifetime environmental impact.
            </p>
            <div class="text-xs text-slate-400 space-y-1">
                <p><strong>Key Fact:</strong> Refurbishing electronics saves 75-78% CO2 emissions compared to manufacturing new devices.</p>
                <p><strong>Global Context:</strong> 62 million metric tons of e-waste generated annually, only 17.4% properly recycled.</p>
            </div>
        </div>
        <p class="mt-6">&copy; 2026 EcoRepairCalc. Built for a greener future.</p>
    </footer>

    <script>
        // --- UPDATED DATA & CONFIGURATION (Research-Backed Feb 2026) ---
        const currentYear = new Date().getFullYear();
        
        // Updated device data based on latest LCA studies (2024-2026)
        // Sources: Fairphone 5 LCA (2024), Dell Latitude LCA, Fraunhofer UMSICHT, 
        //          Refurbed/Fraunhofer Austria (2023), Water Footprint Network
        const deviceData = {
            smartphone: {
                name: "Smartphone",
                baseCO2: 65, // Updated from 60kg - reflects latest studies (range 42-95kg)
                weight: 180, // grams
                waterFactor: 14000, // Litres per device (verified multiple sources)
                
                repairs: {
                    // Component CO2 based on proportional estimates from Fairphone 5 LCA
                    "Screen Replacement": 18, // Display modules are ~30% of manufacturing
                    "Battery Replacement": 8,  // Batteries ~12-15% of total emissions
                    "Charging Port": 2,
                    "Camera Module": 4,        // Cameras ~5-8% of device emissions
                    "Speaker Repair": 1,
                    "Microphone Repair": 1,
                    "Buttons (Power/Volume)": 1,
                    "Back Cover/Glass": 3,
                    "Software Issue": 0.1,     // Minimal material impact
                    "Water Damage Treatment": 12, // Multiple component replacements
                    "Signal/Antenna Issue": 2,
                    "Motherboard/Logic Board": 25 // Core PCB ~35-40% of emissions
                }
            },
            
            tablet: {
                name: "Tablet",
                baseCO2: 95, // Updated - scaled from smartphone data
                weight: 450,
                waterFactor: 20000, // Estimate based on size/complexity ratio
                
                repairs: {
                    "Screen Replacement": 22, // Larger display = higher impact
                    "Battery Replacement": 12,
                    "Charging Port": 2,
                    "Speaker Repair": 1,
                    "Buttons (Power/Volume)": 1,
                    "Camera Module": 3,
                    "Software Issue": 0.1,
                    "Stylus Port/Dock": 1,
                    "Back Cover": 5,
                    "Wi-Fi/Connectivity": 2,
                    "Motherboard": 30
                }
            },
            
            laptop: {
                name: "Laptop",
                baseCO2: 280, // Updated from 260kg - current average (range 210-350kg)
                weight: 2000,
                waterFactor: 190000, // Litres - verified (person could drink for 170 years)
                
                repairs: {
                    // Component data from Dell Latitude LCA breakdown
                    "Screen Assembly": 80,      // Display ~30% of manufacturing
                    "Battery": 20,              // ~7-8% of laptop emissions
                    "Mainboard/Logic Board": 35, // PCBs ~12-15%
                    "Hard Drive / SSD": 40,     // Storage ~14%
                    "RAM Upgrade/Repair": 25,   // Memory ~9%
                    "Keyboard": 12,
                    "Trackpad": 3,
                    "Cooling Fan": 3,
                    "Hinge Repair": 4,
                    "Speaker Repair": 2,
                    "USB/IO Ports": 2,
                    "Webcam": 2,
                    "WiFi Card": 2,
                    "Software Issue": 0.1,
                    "Power Supply / Charger": 18,
                    "Bottom Case/Chassis": 8,
                    "Top Case/Palmrest": 6
                }
            },
            
            desktop: {
                name: "Desktop PC",
                baseCO2: 320, // Updated base system value
                weight: 8000,
                waterFactor: 250000, // Estimate for larger manufacturing footprint
                
                repairs: {
                    "Power Supply Unit (PSU)": 75,
                    "Hard Drive / SSD": 40,
                    "RAM Memory": 25,
                    "Graphics Card (GPU)": 250, // Mid-range GPU replacement
                    "CPU Cooler / Fan": 10,
                    "Motherboard": 80,
                    "CPU": 95,
                    "USB/IO Ports": 2,
                    "Software Issue": 0.1,
                    "Monitor Repair": 80,
                    "Keyboard/Mouse": 5
                }
            }
        };

        // Updated Conversion Factors (verified from EPA and academic sources)
        const factors = {
            carKm: 0.192,       // kg CO2 per km driven (avg car)
            treeYear: 21,       // kg CO2 absorbed per tree seedling per year
            phoneCharge: 0.007  // kg CO2 per phone charge
        };

        // Condition UI Data
        const conditionData = {
            1: { text: "Dead / Won't Turn On", emoji: "ðŸ’€" },
            2: { text: "Major Damage (Unusable)", emoji: "ðŸ˜«" },
            3: { text: "Usable but Glitchy", emoji: "ðŸ˜" },
            4: { text: "Minor Wear / Battery Issues", emoji: "ðŸ™‚" },
            5: { text: "Like New / Fully Functional", emoji: "ðŸ¤©" }
        };

        // --- Init Functions ---

        function populateYears() {
            const manSelect = document.getElementById('manYear');
            const manSelectDesk = document.getElementById('manYearDesktop');
            const repSelect = document.getElementById('repYear');
            
            for (let y = currentYear; y >= currentYear - 15; y--) {
                const opt = document.createElement('option');
                opt.value = y;
                opt.text = y;
                manSelect.add(opt);
                manSelectDesk.add(opt.cloneNode(true));
            }

            for (let y = currentYear; y >= currentYear - 5; y--) {
                const opt = document.createElement('option');
                opt.value = y;
                opt.text = y;
                repSelect.add(opt);
            }
        }

        function handleDeviceChange() {
            const deviceType = document.querySelector('input[name="device"]:checked').value;
            const standardInput = document.getElementById('standardModelInput');
            const desktopInput = document.getElementById('desktopComponentInput');
            
            if (deviceType === 'desktop') {
                standardInput.classList.add('hidden');
                desktopInput.classList.remove('hidden');
            } else {
                standardInput.classList.remove('hidden');
                desktopInput.classList.add('hidden');
            }
            updateRepairs();
        }

        function updateRepairs() {
            const deviceType = document.querySelector('input[name="device"]:checked').value;
            const repairList = document.getElementById('repairList');
            repairList.innerHTML = '';
            
            const repairs = deviceData[deviceType].repairs;
            
            for (const [part, impact] of Object.entries(repairs)) {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-3 p-2 hover:bg-slate-100 rounded-md cursor-pointer transition';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.name = 'repairOption';
                checkbox.value = impact;
                checkbox.className = 'custom-checkbox form-checkbox h-5 w-5 text-eco-600 rounded border-slate-300 focus:ring-eco-500 transition duration-150 ease-in-out';
                
                const span = document.createElement('div');
                span.className = 'text-sm text-slate-700 select-none';
                span.textContent = part;
                
                label.appendChild(checkbox);
                label.appendChild(span);
                repairList.appendChild(label);
            }
        }

        function updateConditionUI(val) {
            document.getElementById('conditionLabel').innerText = conditionData[val].text;
            document.getElementById('conditionEmoji').innerText = conditionData[val].emoji;
        }

        function showTypingHint() {
            const hint = document.getElementById('modelHint');
            const val = document.getElementById('modelName').value;
            if(val.length > 2) {
                hint.classList.remove('hidden');
            } else {
                hint.classList.add('hidden');
            }
        }

        // --- Advanced Carbon Estimation Logic ---
        
        function getRefinedCarbon(deviceKey, modelName) {
            let base = deviceData[deviceKey].baseCO2;
            
            // Desktop: sum component values
            if (deviceKey === 'desktop') {
                const cpu = parseInt(document.getElementById('compCPU').value);
                const gpu = parseInt(document.getElementById('compGPU').value);
                const mobo = parseInt(document.getElementById('compMobo').value);
                const ram = parseInt(document.getElementById('compRAM').value);
                const psu = parseInt(document.getElementById('compPSU').value);
                const casing = parseInt(document.getElementById('compCase').value);
                
                // Base (320) covers monitor, storage, cables, transport
                // Components add to this
                return base + cpu + gpu + mobo + ram + psu + casing;
            }

            // Model-based refinement for smartphones, laptops, tablets
            const lowerModel = modelName.toLowerCase();
            
            if (deviceKey === 'smartphone') { 
                // High-end models: 85kg range
                if (lowerModel.includes('pro') || lowerModel.includes('max') || 
                    lowerModel.includes('ultra') || lowerModel.includes('fold')) {
                    base = 85;
                } 
                // Budget models: 45kg range
                else if (lowerModel.includes('mini') || lowerModel.includes('lite') || 
                         lowerModel.includes('se') || lowerModel.includes('a series')) {
                    base = 45;
                }
                // Standard stays at 65kg
            }
            
            else if (deviceKey === 'laptop') { 
                // Gaming/High-performance: 340kg
                if (lowerModel.includes('gaming') || lowerModel.includes('alienware') || 
                    lowerModel.includes('pro') || lowerModel.includes('legion') || 
                    lowerModel.includes('16') || lowerModel.includes('17')) {
                    base = 340;
                } 
                // Ultrabooks/Light models: 210kg
                else if (lowerModel.includes('air') || lowerModel.includes('chromebook') || 
                         lowerModel.includes('surface go') || lowerModel.includes('tablet')) {
                    base = 210;
                }
                // Standard stays at 280kg
            }

            else if (deviceKey === 'tablet') { 
                // Pro models
                if (lowerModel.includes('pro') || lowerModel.includes('ultra')) {
                    base = 120;
                } 
                // Mini models
                else if (lowerModel.includes('mini')) {
                    base = 70;
                }
                // Standard stays at 95kg
            }

            return base;
        }

        // --- Calculation Logic ---

        function calculateImpact(e) {
            e.preventDefault();

            // Get device data
            const deviceKey = document.querySelector('input[name="device"]:checked').value;
            const device = deviceData[deviceKey];
            const modelName = document.getElementById('modelName').value;
            
            // 1. Get refined embodied carbon based on model name or components
            const newDeviceImpact = getRefinedCarbon(deviceKey, modelName);
            
            // 2. Calculate total repair cost from checked repairs
            const checkboxes = document.querySelectorAll('input[name="repairOption"]:checked');
            let repairImpact = 0;
            
            checkboxes.forEach((cb) => {
                repairImpact += parseFloat(cb.value);
            });
            
            // 3. Savings calculation
            const savings = newDeviceImpact - repairImpact;
            const finalSavings = savings > 0 ? savings : 0;
            const reductionPercent = ((finalSavings / newDeviceImpact) * 100).toFixed(1);

            // Equivalent stats
            const carKm = (finalSavings / factors.carKm).toFixed(1);
            const carMiles = (carKm * 0.621371).toFixed(1);
            const waste = device.weight;
            
            // Water savings - assumes repair saves full device water footprint
            // (repair water cost negligible compared to 190,000L manufacturing)
            const water = device.waterFactor.toLocaleString();

            // Tree calculation (21 kg CO2 per tree-year)
            const treesPlanted = (finalSavings / factors.treeYear).toFixed(2);

            // Update UI
            document.getElementById('welcomeState').classList.add('hidden');
            document.getElementById('resultsState').classList.remove('hidden');

            // Animate numbers
            animateValue("savedKg", 0, finalSavings.toFixed(1), 1000);
            animateValue("carKm", 0, carKm, 1500);
            document.getElementById('carMiles').innerText = carMiles;
            document.getElementById('reductionPercent').innerText = reductionPercent + "%";
            document.getElementById('treesSaved').innerText = treesPlanted;
            document.getElementById('waterSaved').innerText = water;
            document.getElementById('wasteSaved').innerText = waste;
            document.getElementById('newEmission').innerText = newDeviceImpact;
            document.getElementById('repairEmission').innerText = repairImpact.toFixed(1);

            // Update recommendation
            updateRecommendation(finalSavings, reductionPercent, deviceKey);

            // Render chart
            renderChart(newDeviceImpact, repairImpact);
            
            // Scroll to results on mobile
            if(window.innerWidth < 768) {
                document.getElementById('resultsState').scrollIntoView({behavior: 'smooth'});
            }
        }

        function updateRecommendation(savings, percent, deviceType) {
            const recText = document.getElementById('recommendationText');
            
            if (percent >= 70) {
                recText.innerHTML = `<strong>Highly Recommended!</strong> Repairing saves ${percent}% carbon vs buying new. Studies show extending device life by just 1 year reduces your annual environmental impact by up to 31%.`;
            } else if (percent >= 40) {
                recText.innerHTML = `<strong>Worth Repairing.</strong> You'll save ${percent}% carbon emissions. Every year you extend your ${deviceType}'s life significantly reduces its environmental footprint.`;
            } else if (percent >= 20) {
                recText.innerHTML = `Repairing saves ${percent}% carbon. While modest, this still prevents e-waste and conserves resources. Consider if the device can last 2+ more years for maximum benefit.`;
            } else {
                recText.innerHTML = `The repair saves ${percent}% carbon. For minimal savings, you might consider a refurbished device (saves ~75% vs new) if your current device has reached end-of-life.`;
            }
        }

        // --- Utilities ---

        function animateValue(id, start, end, duration) {
            if (start === end) return;
            const range = end - start;
            let current = start;
            const obj = document.getElementById(id);
            const timer = setInterval(function() {
                current = parseFloat(current) + (range / 20); 
                if (current >= end) {
                    current = end;
                    clearInterval(timer);
                }
                obj.innerHTML = parseFloat(current).toFixed(1);
            }, 50);
        }

        let impactChart = null;

        function renderChart(newData, repairData) {
            const ctx = document.getElementById('impactChart').getContext('2d');
            
            if (impactChart) {
                impactChart.destroy();
            }

            impactChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Buying New', 'Repairing'],
                    datasets: [{
                        label: 'Carbon Footprint (kg CO2e)',
                        data: [newData, repairData],
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.7)',
                            'rgba(34, 197, 94, 0.7)'
                        ],
                        borderColor: [
                            'rgb(239, 68, 68)',
                            'rgb(34, 197, 94)'
                        ],
                        borderWidth: 1,
                        borderRadius: 10,
                        barThickness: 50
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // --- Startup ---
        window.addEventListener('DOMContentLoaded', () => {
            populateYears();
            updateRepairs();
            updateConditionUI(3);
        });

    </script>
</body>
</html>
